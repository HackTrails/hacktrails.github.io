<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Bounty Writeups</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <div class="container max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-8">
        <h1 class="text-3xl font-semibold text-blue-600 text-center mb-6">Bug Bounty Writeups</h1>
        <div id="loading-indicator" class="text-center py-4">
            <svg class="animate-spin h-5 w-5 text-blue-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-2 text-gray-500">Loading writeups...</p>
        </div>
        <div id="error-display" class="text-center text-red-500 py-4" style="display: none;"></div>
        <div id="writeups-list" class="space-y-4">
            </div>
    </div>

    <script>
        const writeupsList = document.getElementById('writeups-list');
        const loadingIndicator = document.getElementById('loading-indicator');
        const errorDisplay = document.getElementById('error-display');

        function displayWriteups(writeups) {
            loadingIndicator.style.display = 'none';
            if (writeups.length === 0) {
                errorDisplay.textContent = "No writeups found.";
                errorDisplay.style.display = 'block';
                return;
            }

            writeups.forEach(writeup => {
                const writeupElement = document.createElement('div');
                writeupElement.classList.add('bg-white', 'rounded-lg', 'shadow-md', 'p-6', 'border-l-4', 'border-blue-500');

                const titleElement = document.createElement('h2');
                titleElement.classList.add('text-xl', 'font-semibold', 'text-gray-800', 'mb-2');
                titleElement.textContent = writeup.title;

                const authorElement = document.createElement('p');
                authorElement.classList.add('text-gray-600', 'mb-1');
                authorElement.textContent = `Author: ${writeup.author || 'Unknown'}`;

                const dateElement = document.createElement('p');
                dateElement.classList.add('text-gray-500', 'text-sm', 'mb-2');
                const publishedDate = writeup.published_date
                    ? new Date(writeup.published_date).toLocaleDateString('en-US', { 
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    })
                    : 'Unknown';
                dateElement.textContent = `Published: ${publishedDate}`;

                const summaryElement = document.createElement('p');
                summaryElement.classList.add('text-gray-700', 'mb-3');
                summaryElement.textContent = writeup.hacktivity_summary || 'No summary available.';

                const linkElement = document.createElement('a');
                linkElement.classList.add('text-blue-500', 'hover:text-blue-700', 'underline', 'font-medium');
                linkElement.href = writeup.link;
                linkElement.textContent = 'Read More';
                linkElement.target = '_blank'; // Open in new tab

                writeupElement.appendChild(titleElement);
                writeupElement.appendChild(authorElement);
                writeupElement.appendChild(dateElement);
                writeupElement.appendChild(summaryElement);
                writeupElement.appendChild(linkElement);
                writeupsList.appendChild(writeupElement);
            });
        }

        function fetchWriteups() {
            loadingIndicator.style.display = 'block';
            errorDisplay.style.display = 'none';

            const cloudFunctionUrl = 'https://get-writeups-5kluvqgioa-uc.a.run.app/get_writeups';

            fetch(cloudFunctionUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const writeups = data.map(item => {
                         if (item.published_date) {
                            item.published_date = new Date(item.published_date.seconds * 1000);
                         }
                         return item;
                    });
                    displayWriteups(writeups);
                })
                .catch(error => {
                    console.error("Error fetching writeups: ", error);
                    loadingIndicator.style.display = 'none';
                    errorDisplay.textContent = "Failed to load writeups. Please check your connection and try again.";
                    errorDisplay.style.display = 'block';
                });
        }

        // Fetch and display writeups when the page loads
        fetchWriteups();
    </script>
</body>
</html>
